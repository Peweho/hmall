# 商品服务开发文档

## 一、项目功能

### 1、api服务

- #### 查询购物车列表 （query_cart_logic.go)

  ![](../../img/购物车查询时序图.jpg)

  > - 先查询缓存的数据，有则序列化后返回
  > - 没有则查询购物车数据库，获得商品id结合
  > - 调用商品服务的RPC方法获得商品信息
  > - 构造数据返回，同时异步写缓存

- #### 添加商品到购物车 （add_cart_logic.go）

  > - 修改数据库，获取商品的id，调用mq服务异步更新缓存

- #### 更新购物车数据（update_cart_logic.go）

- #### 批量删除购物车中商品（del_cart_items_logic.go）

- #### 删除购物车中商品（del_cart_item_logic.go）

  > - 修改数据库，有缓存则修改缓存

### 2、mq服务

- #### 添加缓存（paymentSuccess.go）

  > - 根据Id调用商品服务的RPC方法查找购物车的商品，构建购物车数据，最后加入缓存
  
- #### 删除缓存